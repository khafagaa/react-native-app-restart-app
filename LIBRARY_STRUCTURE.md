# React Native App Restart Library - Complete Structure

## üìÅ Library Structure

```
react-native-app-restart/
‚îú‚îÄ‚îÄ src/                          # TypeScript source code
‚îÇ   ‚îî‚îÄ‚îÄ index.tsx                 # Main library entry point with TypeScript
‚îÇ
‚îú‚îÄ‚îÄ lib/                          # Compiled JavaScript (generated by TypeScript)
‚îÇ   ‚îú‚îÄ‚îÄ index.js                  # Compiled JavaScript
‚îÇ   ‚îî‚îÄ‚îÄ index.d.ts                # TypeScript type definitions
‚îÇ
‚îú‚îÄ‚îÄ android/                      # Android native module
‚îÇ   ‚îú‚îÄ‚îÄ build.gradle              # Android build configuration
‚îÇ   ‚îî‚îÄ‚îÄ src/main/
‚îÇ       ‚îú‚îÄ‚îÄ AndroidManifest.xml   # Android manifest
‚îÇ       ‚îî‚îÄ‚îÄ java/com/reactnativeapprestart/
‚îÇ           ‚îú‚îÄ‚îÄ AppRestartModule.kt        # Native restart implementation
‚îÇ           ‚îî‚îÄ‚îÄ AppRestartPackage.kt       # React Native package registration
‚îÇ
‚îú‚îÄ‚îÄ ios/                          # iOS native module
‚îÇ   ‚îú‚îÄ‚îÄ AppRestartModule.h        # Objective-C header file
‚îÇ   ‚îî‚îÄ‚îÄ AppRestartModule.m        # Objective-C implementation
‚îÇ
‚îú‚îÄ‚îÄ package.json                  # NPM package configuration
‚îú‚îÄ‚îÄ tsconfig.json                 # TypeScript configuration
‚îú‚îÄ‚îÄ react-native-app-restart.podspec  # CocoaPods specification for iOS
‚îú‚îÄ‚îÄ README.md                     # User documentation
‚îú‚îÄ‚îÄ INTEGRATION.md                # Integration guide for ADIO mobile
‚îú‚îÄ‚îÄ LIBRARY_STRUCTURE.md          # This file
‚îú‚îÄ‚îÄ .gitignore                    # Git ignore rules
‚îî‚îÄ‚îÄ .npmignore                    # NPM publish ignore rules
```

## üìù File Descriptions

### Source Code (src/)

**`src/index.tsx`**

- TypeScript interface for the native module
- Exports `restart()` function
- Handles linking errors gracefully
- Provides TypeScript types

### Compiled Output (lib/)

**`lib/index.js`**

- Compiled JavaScript (CommonJS)
- Generated automatically by TypeScript compiler
- This is what gets imported by React Native

**`lib/index.d.ts`**

- TypeScript type definitions
- Provides autocomplete and type checking
- Generated automatically from source

### Android Native (android/)

**`android/build.gradle`**

- Android library build configuration
- Kotlin support enabled
- Dependencies: React Native, Kotlin stdlib

**`android/src/main/AndroidManifest.xml`**

- Required Android manifest file
- Minimal configuration for library

**`android/src/main/java/com/reactnativeapprestart/AppRestartModule.kt`**

- Native Kotlin implementation
- Completely restarts the app by:
  1. Getting the launch intent
  2. Adding flags for new task and clear task
  3. Starting the activity
  4. Exiting the current process

**`android/src/main/java/com/reactnativeapprestart/AppRestartPackage.kt`**

- Registers the native module with React Native
- Required for React Native to discover the module

### iOS Native (ios/)

**`ios/AppRestartModule.h`**

- Objective-C header file
- Declares the module interface
- Conforms to RCTBridgeModule protocol

**`ios/AppRestartModule.m`**

- Objective-C implementation
- Reloads JS bundle using RCTTriggerReloadCommandListeners
- Different behavior for debug vs release builds

### Configuration Files

**`package.json`**

- NPM package configuration
- Dependencies and peer dependencies
- Build scripts
- Package metadata

**`tsconfig.json`**

- TypeScript compiler configuration
- Targets ES2020
- Outputs to lib/ directory
- Generates declaration files

**`react-native-app-restart.podspec`**

- CocoaPods specification for iOS
- Enables autolinking
- Declares dependencies on React-Core

### Documentation

**`README.md`**

- Complete user documentation
- Installation instructions
- Usage examples
- Troubleshooting guide

**`INTEGRATION.md`**

- Specific integration guide for ADIO mobile
- Step-by-step setup instructions
- Migration from old JSRestartModule
- Cleanup instructions

**`LIBRARY_STRUCTURE.md`** (this file)

- Complete library structure overview
- File descriptions
- Technical architecture

## üîß How It Works

### JavaScript Layer

1. User imports the library:

   ```typescript
   import AppRestart from 'react-native-app-restart';
   ```

2. User calls `restart()`:

   ```typescript
   AppRestart.restart();
   ```

3. The TypeScript wrapper calls the native module:
   ```typescript
   NativeModules.AppRestartModule.reload();
   ```

### Native Layer (Android)

1. `AppRestartModule.reload()` is called
2. Gets the current activity and package manager
3. Creates launch intent with flags:
   - `FLAG_ACTIVITY_NEW_TASK`: Start in new task
   - `FLAG_ACTIVITY_CLEAR_TASK`: Clear all activities
4. Starts the activity
5. Exits current process with `Runtime.getRuntime().exit(0)`
6. App restarts completely fresh

### Native Layer (iOS)

1. `AppRestartModule.reload()` is called
2. Dispatches to main queue (UI thread)
3. Calls `RCTTriggerReloadCommandListeners(@"Manual reload")`
4. React Native reloads the JS bundle
5. UI refreshes with new bundle

## üéØ Key Features

### Type Safety

- Full TypeScript support
- Type definitions automatically generated
- Autocomplete in IDEs

### Error Handling

- Graceful degradation if not linked
- Helpful error messages
- Platform-specific logging

### Platform Differences

- **Android**: Complete app restart (full reset)
- **iOS**: JS bundle reload (faster, preserves some state)

### Developer Experience

- Simple API (single function)
- Clear documentation
- Easy integration
- Autolinking support

## üèóÔ∏è Build Process

### Development Build

```bash
npm install    # Install dependencies
npm run build  # Compile TypeScript
```

This runs `tsc` which:

1. Reads `tsconfig.json`
2. Compiles `src/index.tsx` ‚Üí `lib/index.js`
3. Generates `lib/index.d.ts` type definitions

### Package Preparation

The `prepare` script in `package.json` automatically runs `npm run build` when:

- Running `npm install` in the package
- Publishing to NPM
- Installing from file: reference

## üì¶ Distribution

### Local (Current Setup)

```json
{
  "dependencies": {
    "react-native-app-restart": "file:./libraries/react-native-app-restart"
  }
}
```

### NPM Registry (Future)

```bash
npm publish
```

Then in projects:

```bash
npm install react-native-app-restart
```

## üîó Linking

### Autolinking (React Native 0.60+)

Works automatically for both platforms when:

1. Package is in dependencies
2. iOS: `pod install` is run
3. Android: Project is rebuilt

### Manual Linking (if needed)

See `INTEGRATION.md` for detailed manual linking instructions.

## üß™ Testing in Your App

### 1. Add to Dependencies

```bash
cd /Users/mis/Documents/ADIO_mobile
npm install
```

### 2. iOS Setup

```bash
cd ios
pod install
cd ..
```

### 3. Android - Verify Autolinking

Check that `MainApplication.kt` has the package (may be automatic).

### 4. Usage

```typescript
import AppRestart from 'react-native-app-restart';

// In your language selector component
const handleLanguageChange = async (lang: string) => {
  await saveLang(lang);
  AppRestart.restart();
};
```

## üìä Comparison with Old Implementation

| Aspect        | Old JSRestartModule | New react-native-app-restart    |
| ------------- | ------------------- | ------------------------------- |
| Location      | Embedded in app     | Separate library                |
| Reusability   | App-specific        | Can use in any project          |
| Types         | No TypeScript       | Full TypeScript support         |
| Documentation | Comments only       | Complete docs + examples        |
| Versioning    | None                | Versioned package               |
| Testing       | Coupled with app    | Can test independently          |
| Maintenance   | Scattered files     | Centralized in library          |
| Distribution  | Copy files          | NPM package (local or registry) |

## ‚úÖ Advantages of Library Approach

1. **Modularity**: Self-contained, independent module
2. **Reusability**: Use across multiple projects
3. **Maintainability**: Single source of truth
4. **Type Safety**: TypeScript definitions included
5. **Documentation**: Comprehensive docs and examples
6. **Testing**: Can be tested in isolation
7. **Versioning**: Track changes with semantic versioning
8. **Distribution**: Easy to share (file:, git, or npm)

## üöÄ Next Steps

1. ‚úÖ Library created and built
2. ‚è≠Ô∏è Add to main app dependencies
3. ‚è≠Ô∏è Install iOS pods
4. ‚è≠Ô∏è Rebuild app
5. ‚è≠Ô∏è Test restart functionality
6. ‚è≠Ô∏è Migrate existing JSRestartModule usage
7. ‚è≠Ô∏è Remove old implementation files

See `INTEGRATION.md` for detailed integration steps.
